{% extends 'vendas/base.html' %}
{% load static %}
{% block content %}
	<div class="row">
		<div class="col-lg-6">
			<div class="box-element" id="form-wrapper">
				<form id="form">
					<div id="shipping-info">
						<p>Modo de Pagamento:</p>
						<div class="form-field">
							<select name="cars" id="cars">
								<option value="credito">Credito</option>
								<option value="debito">Debito</option>
								<option value="pix">Pix</option>
								<option value="boleto">Boleto</option>
							  </select>
						</div>
						
					</div>

					<hr>
					<input id="form-button" class="btn btn-success btn-block" type="submit"
						value="Continue">
				</form>
			</div>

			<br>
		</div>

		<div class="col-lg-6">
			<div class="box-element">
				<a class="btn btn-outline-dark" href="{% url 'carrinho' %}">&#x2190; voltar
					ao carrinho</a>
				<hr>
				<h3>Order Summary</h3>
				<hr>
				{% for item in itens %}
				<div class="carrinho-row">
					<div style="flex:2"><img class="row-image" src="{{item.produto.imageURL}}"></div>
					<div style="flex:2"><p>{{item.produto.nome}}</p></div>
					<div style="flex:1"><p>${{item.produto.preco|floatformat:2}}</p></div>
					<div style="flex:1"><p>x{{item.quantidade}}</p></div>
				</div>
				{% endfor %}
				<h5>Itens: {{pedido.get_carrinho_itens}}</h5>
				<h5>Total: ${{pedido.get_carrinho_total|floatformat:2}}</h5>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		var total = '{{pedido.get_carrinho_total}}'


			var form = document.getElementById('form')
			form.addEventListener('submit', function(e){
				e.preventDefault()
				console.log('Form Submitted...')
				document.getElementById('form-button').classList.add("hidden");
				submitFormData()
			})

			/*
			document.getElementById('make-payment').addEventListener('click', function(e){
				submitFormData()
			})
			*/

			function submitFormData(){
				console.log('Payment button clicked')

				var userFormData = {
					'name':null,
					'email':null,
					'total':total,
				}

				var url = "/processarPedido/"
				fetch(url, {
					method:'POST',
					headers:{
						'Content-Type':'applicaiton/json',
						'X-CSRFToken':csrftoken,
					}, 
					body:JSON.stringify({'form':userFormData}),
					
				})
				.then((response) => response.json())
				.then((data) => {

					carrinho = {}
					document.cookie ='carrinho=' + JSON.stringify(carrinho) + ";domain=;path=/"

					window.location.href = "{% url 'produtos' %}"

					})
			}
	</script>
{% endblock content %}